# 無料期間について
AWSのアカウントには「12ヶ月間、一定の使用量までは様々なサービスを無料で利用できる」という無料枠が用意されている。  
この無料枠はアカウント登録から12ヶ月を過ぎると無料期間が終了し、使用量に応じて料金が発生する。  
また12ヶ月以内でも、使用量が無料枠を超えてしまった場合には、料金が発生する仕組みになっている。  

つまり、以下どちらかの要件に当てはまると、料金が発生することになる。  

1. アカウント作成から12ヶ月以内に、一定の使用量をオーバーする
2. アカウント作成から12ヶ月以降に、AWSのサービスを利用する  

オリジナルアプリで使用したサービスの無料枠は以下の通り。

|サービス名|無料枠|
|:---|:---|
|Amazon EC2|750時間/月 (t2.microインスタンスの使用もこれに含む)まで|
|Amazon S3|5GBの標準ストレージ、20,000件のGETリクエスト、2,000件のPUTリクエスト|
|Elastic IPアドレス	|実行中のインスタンスに関連づけられたElastic IPアドレスを1つだけ|

以下の場合は課金対象になる。

|サービス名|料金が発生する場合|
|:---|:---|
|Elastic IPアドレス|インスタンスに紐付いていないElastic IPアドレスがある|
|IAM|IAMユーザーの一時的なセキュリティ認証情報を使用して、他のAWSサービスにアクセスする|
<br>

# 2つ目以降のインスタンスを作成する際の課金を回避するために
インスタンスを作成し直す際や、最終課題等の別アプリケーションをデプロイするために別インスタンスを立ち上げることになる。  
その際、料金の発生を回避するためには以下の点に注意しよう。  
料金が発生しても構わない場合は、以下の手順を踏む必要はない。  
<br>

## 2つ目以降のインスタンスを立ち上げる際に踏む手順
1. Elastic IPアドレスを解放する  
2. （すでに作成済みで、これ以上必要の無い場合）紐付いているS3バケットを削除する
3. インスタンスを削除する
4. 新たなインスタンス立ち上げを行う
  
上記1~3については以下のセクションより説明。  
<br>

# 課金を防ぐための各手順
EC2やElastic IPアドレス、S3を停止または削除する方法。  
いずれも詳細はAWS公式ドキュメントを確認する。  
<br>

## Elastic IPアドレスを解放する
後ほどインスタンスを停止させるが、インスタンスが停止していても、Elastic IPアドレスが複数存在する場合は料金が発生する。  
そのため、インスタンスを停止するときには、そのインスタンスと紐づいているElastic IPアドレスも解放する必要がある。  

1. (https://console.aws.amazon.com/ec2/) にある Amazon EC2 コンソールを開く。
2. ナビゲーションペインで [Elastic IP] を選択する。
3. Elastic IP アドレスを選択し、[Actions]、[Release addresses] の順に選択する。プロンプトが表示されたら、[Release] を選択する。  

参考URL: [Elastic IPアドレスを解放する方法](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html#using-instance-addressing-eips-releasing)  

Elastic IPアドレスが解放できたかは下の画像のように確認ができる。  

<img height="400" width="800" alt="AWS-image" src="https://i.gyazo.com/531a2b95f9ee7aa60ef07b1771229239.png">
<br>

# S3バケットを削除する
今後、使用予定のない不要なバケットである場合、以下の手順で削除することができる。(ただし、同じバケット名を別のサービス等で使いたい場合は、バケットの中身を空にするようにる。)  

1. AWS マネジメントコンソール にサインインし、Amazon S3 コンソール (https://console.aws.amazon.com/s3/) を開く。  
2. [バケット名] リストで、削除するバケットの名前の横にあるバケットアイコンを選択し、[バケットを削除する] を選択する。  
3. [バケットを削除する] ダイアログボックスで、削除するバケットの名前を確認のために入力し、[確認] を選択する。  

参考URL: [S3バケットを削除する方法](https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/user-guide/delete-bucket.html)  

S3バケットが削除できたかは下の画像のように確認ができる。  

<img height="500" width="900" alt="AWS-image" src="https://i.gyazo.com/04b860a2e7de0d31299faf278db74713.png">
<br>

# EC2インスタンスを停止させる
インスタンスを停止するとEIastic IPアドレスは関連づけられなくなるので、あらかじめEIastic IPアドレスを解放し課金されないように気をつける。 

1. ナビゲーションペインで [Instances] を選択し、インスタンスを選択。  

2. [Actions] を選択して [Instance State] を選択し、[Stop] を選択。  
[Stop] が無効になっている場合は、インスタンスが既に停止しているか、またはルートボリュームがインスタンスストアボリューム。（インスタンスを停止すると、インスタンスストアボリューム上のデータは消去される。インスタンスストアボリュームのデータを保持するには、このデータを永続的ストレージに必ずバックアップすること。）  

3. 確認ダイアログボックスで [Yes, Stop] を選択する。  

※インスタンスが停止するまで、数分かかる場合がある。  

参考URL： [インスタンスの停止と起動](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/Stop_Start.html)  

EC2インスタンスが停止できたかは下の画像のように確認がでる。  

<img height="500" width="900" alt="AWS-image" src="https://i.gyazo.com/519c4bb5e476e9ca1c5f0373824948ce.png">
<br>

# 最後に
## 費用はこまめに確認する

発生している料金については、AWSの請求ダッシュボードからいつでも確認することができる。  
気になる場合は、こまめに確認するようにする。
AWSの請求ダッシュボードは以下の手順で見ることができる。  

1. AWSのサイトにルートユーザー でログインする。
2. 画面右上の「ユーザー名」をクリックし、「マイ請求ダッシュボード」を選択。  

<img height="500" width="900" alt="AWS-image" src="https://i.gyazo.com/277b9798be81b0b7437ae9451d994f6a.png">
<br>

3. 以下のような使用料金のグラフが表示されるので、料金を確認。  
「$0」と表示されていれば、現時点で使用料金はかかっていないということである。  

<img height="500" width="900" alt="AWS-image" src="https://i.gyazo.com/eb3d82df2c9dc45df9e7faa6bf515b63.png">
<br>

# インスタンスを複数作成して課金されたとしたらいくら位になるのか
もしインスタンスの停止やElastic IPアドレスの解放を失念した状態で複数のインスタンスを作成した場合、状況によるが毎月500~3000円程度の費用が発生する。  
もちろん状況によっては数万円程度に達することもあるが、多くの場合法外な費用が発生するわけではないので、落ち着いて対応する。  
<br>

# 法外な課金がされる場合
awsのアクセスキーをgithubにpushした際などに、不正に利用されて数十万円の課金がされることがある。  
Webで検索して見つけた記事などを参考にし、デプロイ作業等を進める場合は注意する。  
<br>

# 不明な課金がされている場合
その他にも数十円の料金が発生していたり、不明な料金が発生していることがあったら以下のような対応を取る。  

- AWSのカスタマーサポートに問い合わせてみる
- 解決しない場合は、AWSのアカウントごと消去する  

# 高度な設定
費用発生を最小限に留めるために、EC2を自動でシャットダウンされるように設定したり、無料利用枠を超えないようにS3でオブジェクトの有効期限を設定できる。  
以下のリンクを参考  

[無駄なコストを省こう！AWSで消し忘れを防止するためにチェックすべき７つのポイント](https://dev.classmethod.jp/articles/cost-check-point/)  

AWSのようなクラウドコンピューティングサービスはこれからも広く使われて行くものである。  
正しく使えば適正な費用しか発生しないので、しっかりと調査を行いつつ、様々なチャレンジをする。

